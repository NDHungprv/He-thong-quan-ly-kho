<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√¥ng C·ª• L·∫≠p L·ªãch Kho</title>
    <style>
        /* GIAO DI·ªÜN G·ªêC */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, sans-serif; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 15px; color: #333; }
        .container { max-width: 900px; margin: auto; background: #fff; padding: 25px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); }
        h1 { color: #4a148c; text-align: center; margin-bottom: 20px; font-size: 1.6rem; }
        
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .input-group { border: 1px solid #eee; padding: 12px; border-radius: 10px; background: #fcfcfc; }
        .full-width { grid-column: span 2; }
        label { display: block; margin-bottom: 6px; font-weight: bold; color: #555; font-size: 0.85rem; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; }
        
        .btn-group { display: flex; gap: 10px; margin-bottom: 20px; }
        button.main-btn { flex: 2; background: #6f42c1; color: white; padding: 15px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: bold; transition: 0.3s; }
        .copy-btn { flex: 1; background: #17a2b8; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }

        #summaryText { margin-bottom: 15px; padding: 12px; border-radius: 8px; text-align: center; display: none; font-size: 0.9rem; }
        .success { background: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }
        .error { background: #ffebee; color: #c62828; border: 1px solid #ffcdd2; display: block !important; }

        /* T·ªêI ∆ØU B·∫¢NG V√Ä TƒÇNG K√çCH TH∆Ø·ªöC CH·ªÆ KHUNG GI·ªú */
        .table-wrapper { 
            width: 100%; 
            overflow-x: auto; 
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        table { width: 100%; border-collapse: collapse; background: white; min-width: 320px; }
        table th, table td { 
            border: 1px solid #dee2e6; 
            padding: 12px 5px; 
            text-align: center; 
        }
        table th { background: #764ba2; color: #ffffff !important; white-space: nowrap; font-size: 0.9rem; }
        
        /* C·ªôt STT nh·ªè l·∫°i */
        .stt-col { width: 40px; font-size: 0.8rem; color: #888; }
        /* C·ªôt Nh√† Kho */
        .name-col { font-weight: 600; font-size: 0.95rem; }
        /* C·ªôt Ph√∫t */
        .dur-col { font-size: 0.85rem; color: #666; }
        
        /* C·ªòT KHUNG GI·ªú - TƒÇNG K√çCH TH∆Ø·ªöC */
        .time-cell { 
            white-space: nowrap; 
            font-weight: 800; /* ƒê·∫≠m h∆°n */
            color: #4a148c; 
            font-size: 1.15rem; /* To h∆°n r√µ r·ªát */
            letter-spacing: -0.5px;
            background-color: #fdfaff; /* N·ªÅn r·∫•t nh·∫°t ƒë·ªÉ l√†m n·ªïi b·∫≠t */
        }

        .header-section { background: #f1f3f5 !important; font-weight: bold; font-size: 0.85rem; color: #444; }

        @media (max-width: 600px) {
            .input-grid { grid-template-columns: 1fr; }
            .full-width { grid-column: span 1; }
            h1 { font-size: 1.3rem; }
            /* V·∫´n gi·ªØ c·ª° ch·ªØ khung gi·ªù l·ªõn tr√™n mobile */
            .time-cell { font-size: 1.05rem; }
            table th, table td { padding: 10px 4px; }
            .container { padding: 15px; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üìÖ L·∫≠p L·ªãch Kho Linh Ho·∫°t</h1>

    <div class="input-grid">
        <div class="input-group">
            <label>T·ªïng s·ªë Nh√† Kho:</label>
            <input type="number" id="warehouseCount" value="24">
        </div>
        <div class="input-group">
            <label>Gi·ªù S√°ng (06:45 - 10:35):</label>
            <div style="display: flex; gap: 5px;">
                <input type="time" id="time_am_start" value="06:45">
                <input type="time" id="time_am_end" value="10:35">
            </div>
        </div>
        <div class="input-group">
            <label>Gi·ªù Chi·ªÅu (13:40 - 16:30):</label>
            <div style="display: flex; gap: 5px;">
                <input type="time" id="time_pm_start" value="13:40">
                <input type="time" id="time_pm_end" value="16:30">
            </div>
        </div>
        <div class="input-group full-width">
            <label>T√™n Nh√† Kho:</label>
            <textarea id="warehouseNames" rows="3">K1, K2, K3, K4, K5, K6, K15, K16, K17, K18, K19, K20, K21, K22, K23, K24, K27, K29, K30, K31, K32, K33, K34, K35</textarea>
        </div>
        <div class="input-group full-width">
            <label>Di chuy·ªÉn (ph√∫t):</label>
            <textarea id="travelTimes" rows="2">4,4,3,5,4,3,4,4,5,3,4,4,4,3,5,4,4,3,4,5,4,3,4</textarea>
        </div>
    </div>

    <div class="btn-group">
        <button class="main-btn" onclick="calculateSchedule()">T·∫†O L·ªäCH TR√åNH</button>
        <button class="copy-btn" onclick="copyTable()">COPY</button>
    </div>

    <div id="summaryText"></div>

    <div class="table-wrapper">
        <table id="resultTable"></table>
    </div>
</div>

<script>
    function timeToMinutes(t) { const [h, m] = t.split(':').map(Number); return h * 60 + m; }
    function minutesToTime(m) { return `${String(Math.floor(m/60)).padStart(2,'0')}:${String(m%60).padStart(2,'0')}`; }

    function calculateSchedule() {
        const count = Number(document.getElementById('warehouseCount').value);
        const amS = timeToMinutes(document.getElementById('time_am_start').value);
        const amE = timeToMinutes(document.getElementById('time_am_end').value);
        const pmS = timeToMinutes(document.getElementById('time_pm_start').value);
        const pmE = timeToMinutes(document.getElementById('time_pm_end').value);
        const names = document.getElementById('warehouseNames').value.split(/[,\n]/).map(x => x.trim()).filter(x => x);
        const travels = document.getElementById('travelTimes').value.split(',').map(x => Number(x.trim())).filter(x => !isNaN(x));

        const summary = document.getElementById('summaryText');
        const table = document.getElementById('resultTable');
        summary.style.display = 'block';

        if (names.length !== count || travels.length !== count - 1) {
            summary.className = 'error';
            summary.innerText = "L·ªói d·ªØ li·ªáu: Ki·ªÉm tra l·∫°i s·ªë l∆∞·ª£ng t√™n kho/di chuy·ªÉn.";
            return;
        }

        const totalTravel = travels.reduce((a, b) => a + b, 0);
        const avgTime = Math.floor(((amE - amS + pmE - pmS) - totalTravel) / count);

        if (avgTime < 6) {
            summary.className = 'error';
            summary.innerText = `Qu√° h·∫πp! B√¨nh qu√¢n ch·ªâ ƒë·∫°t ${avgTime} ph/kho (Y√™u c·∫ßu >= 6).`;
            return;
        }

        let amCount = 0, usedAmTime = 0;
        for (let i = 0; i < count; i++) {
            let travel = (i > 0) ? travels[i-1] : 0;
            if (usedAmTime + travel + avgTime <= (amE - amS)) { usedAmTime += travel + avgTime; amCount++; } 
            else break;
        }
        let pmCount = count - amCount;

        function distribute(n, total) {
            if (n <= 0) return [];
            let res = Array(n).fill(Math.floor(total/n));
            let rem = total % n;
            for(let i=0; i<rem; i++) res[i]++;
            for(let i=0; i<n-1; i+=2) {
                let shift = Math.floor(Math.random()*2)+1;
                if(res[i]-shift >= 6) { res[i]-=shift; res[i+1]+=shift; }
            }
            return res;
        }

        const amFinal = distribute(amCount, (amE - amS) - (amCount > 1 ? travels.slice(0, amCount-1).reduce((a,b)=>a+b,0) : 0));
        const pmFinal = distribute(pmCount, (pmE - pmS) - (pmCount > 1 ? travels.slice(amCount, count-1).reduce((a,b)=>a+b,0) : 0));

        summary.className = 'success';
        summary.innerHTML = `ƒê√£ chia: <b>${amCount}</b> s√°ng | <b>${pmCount}</b> chi·ªÅu.`;

        let html = `<thead><tr><th class="stt-col">STT</th><th>Kho</th><th class="dur-col">Ph√∫t</th><th>Khung gi·ªù</th></tr></thead><tbody>`;
        
        html += `<tr class="header-section"><td colspan="4">CA S√ÅNG</td></tr>`;
        let curr = amS;
        for (let i = 0; i < amCount; i++) {
            let end = curr + amFinal[i];
            html += `<tr><td class="stt-col">${i+1}</td><td class="name-col">${names[i]}</td><td class="dur-col">${amFinal[i]}</td><td class="time-cell">${minutesToTime(curr)} - ${minutesToTime(end)}</td></tr>`;
            if (i < amCount - 1) curr = end + travels[i];
        }

        html += `<tr class="header-section"><td colspan="4">CA CHI·ªÄU</td></tr>`;
        curr = pmS;
        for (let i = 0; i < pmCount; i++) {
            let idx = i + amCount;
            let end = curr + pmFinal[i];
            html += `<tr><td class="stt-col">${idx+1}</td><td class="name-col">${names[idx]}</td><td class="dur-col">${pmFinal[i]}</td><td class="time-cell">${minutesToTime(curr)} - ${minutesToTime(end)}</td></tr>`;
            if (i < pmCount - 1) curr = end + travels[idx];
        }
        table.innerHTML = html + `</tbody>`;
    }

    function copyTable() {
        const table = document.getElementById('resultTable');
        const range = document.createRange();
        range.selectNode(table);
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(range);
        document.execCommand('copy');
        alert('ƒê√£ ch√©p l·ªãch tr√¨nh!');
    }
    window.onload = calculateSchedule;
</script>
</body>
</html>
