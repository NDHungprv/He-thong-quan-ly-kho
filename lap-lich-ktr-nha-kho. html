<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√¥ng C·ª• L·∫≠p L·ªãch Ki·ªÉm Tra Kho</title>
    <style>
        /* CSS */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f4f7f6; color: #333; }
        .container { max-width: 900px; margin: auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        h1 { color: #007bff; text-align: center; margin-bottom: 25px; }
        .input-group { margin-bottom: 20px; border: 1px solid #ccc; padding: 15px; border-radius: 8px; }
        .input-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
        .input-group input[type="text"], .input-group input[type="number"], .input-group input[type="time"], .input-group textarea { width: calc(100% - 22px); padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; margin-top: 5px; }
        button { background-color: #28a745; color: white; padding: 12px 25px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; transition: background-color 0.3s; display: block; width: 100%; margin-top: 20px; }
        button:hover { background-color: #218838; }
        
        /* B·∫£ng K·∫øt qu·∫£ */
        #resultTable { width: 100%; border-collapse: collapse; margin-top: 25px; }
        #resultTable th, #resultTable td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        #resultTable th { background-color: #007bff; color: white; text-align: center; }
        #resultTable tr:nth-child(even) { background-color: #f9f9f9; }
        .header-section { background-color: #e9ecef !important; font-weight: bold; text-align: center !important; color: #333; }
        .copy-btn { background-color: #17a2b8; margin-top: 15px; width: auto; padding: 8px 15px; float: right; }
        .copy-btn:hover { background-color: #138496; }
        
        .error-message { color: red; margin-top: 15px; text-align: center; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>üìÖ C√¥ng C·ª• L·∫≠p L·ªãch Ki·ªÉm Tra Kho</h1>

    <div class="input-group">
        <label for="warehouseCount">1. T·ªïng s·ªë Nh√† Kho c·∫ßn ki·ªÉm tra:</label>
        <input type="number" id="warehouseCount" value="24" min="1" required>
    </div>

    <div class="input-group">
        <label for="time_am_start">2. Khung gi·ªù Bu·ªïi S√°ng:</label>
        <input type="time" id="time_am_start" value="06:45" required>
        <input type="time" id="time_am_end" value="10:35" required style="margin-top: 10px;">
    </div>

    <div class="input-group">
        <label for="time_pm_start">3. Khung gi·ªù Bu·ªïi Chi·ªÅu:</label>
        <input type="time" id="time_pm_start" value="13:40" required>
        <input type="time" id="time_pm_end" value="16:30" required style="margin-top: 10px;">
    </div>

    <div class="input-group">
        <label for="warehouseNames">4. T√™n Nh√† Kho (M·ªói kho 1 d√≤ng):</label>
        <textarea id="warehouseNames" rows="6">K1
K2
K3
K4
K5
K6
K15
K16
K17
K18
K19
K20
K21
K22
K23
K24
K27
K29
K30
K31
K32
K33
K34
K35</textarea>
    </div>
    
    <div class="input-group">
        <label for="travelTimes">5. Th·ªùi gian Di chuy·ªÉn (ph√∫t) gi·ªØa c√°c Kho (Theo th·ª© t·ª±, c√°ch nhau b·ªüi d·∫•u ph·∫©y):</label>
        <textarea id="travelTimes" rows="3">4,4,3,5,4,3,4,4,5,3,4,4,4,3,5,4,4,3,4,5,4,3,4</textarea>
        <small> *C·∫ßn **N - 1** gi√° tr·ªã (V√≠ d·ª•: 24 kho c·∫ßn 23 gi√° tr·ªã th·ªùi gian di chuy·ªÉn).</small>
    </div>

    <button onclick="calculateSchedule()">T·∫°o L·ªãch Ki·ªÉm Tra</button>

    <div id="result">
        <div class="error-message" id="errorMessage"></div>
        <button class="copy-btn" onclick="copyTable()">Sao ch√©p B·∫£ng</button>
        <table id="resultTable">
            </table>
    </div>

</div>

<script>
    // JavaScript
    function timeToMinutes(timeStr) {
        const [hours, minutes] = timeStr.split(':').map(Number);
        return hours * 60 + minutes;
    }

    function minutesToTime(totalMinutes) {
        const hours = Math.floor(totalMinutes / 60);
        const minutes = totalMinutes % 60;
        return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
    }

    function calculateSchedule() {
        const warehouseCount = Number(document.getElementById('warehouseCount').value);
        const amStart = document.getElementById('time_am_start').value;
        const amEnd = document.getElementById('time_am_end').value;
        const pmStart = document.getElementById('time_pm_start').value;
        const pmEnd = document.getElementById('time_pm_end').value;
        const namesInput = document.getElementById('warehouseNames').value;
        const travelsInput = document.getElementById('travelTimes').value;
        
        const names = namesInput.split('\n').map(n => n.trim()).filter(n => n);
        const travels = travelsInput.split(',').map(t => Number(t.trim())).filter(t => !isNaN(t));

        const errorDiv = document.getElementById('errorMessage');
        errorDiv.textContent = '';
        document.getElementById('resultTable').innerHTML = '';

        if (names.length !== warehouseCount) {
            errorDiv.textContent = `L·ªói: S·ªë l∆∞·ª£ng t√™n kho (${names.length}) kh√¥ng kh·ªõp v·ªõi T·ªïng s·ªë kho (${warehouseCount}).`;
            return;
        }
        
        if (travels.length !== warehouseCount - 1 && warehouseCount > 0) {
            errorDiv.textContent = `L·ªói: C·∫ßn ${warehouseCount - 1} th·ªùi gian di chuy·ªÉn, nh∆∞ng ch·ªâ c√≥ ${travels.length} gi√° tr·ªã.`;
            return;
        }

        // 1. T√≠nh t·ªïng th·ªùi gian l√†m vi·ªác c√≥ s·∫µn (ph√∫t)
        const amTotal = timeToMinutes(amEnd) - timeToMinutes(amStart);
        const pmTotal = timeToMinutes(pmEnd) - timeToMinutes(pmStart);
        const totalAvailableTime = amTotal + pmTotal;

        // 2. T√≠nh t·ªïng th·ªùi gian di chuy·ªÉn c·∫ßn thi·∫øt
        const totalTravelTime = travels.reduce((a, b) => a + b, 0);

        // 3. T√≠nh th·ªùi gian ki·ªÉm tra th·ª±c t·∫ø (ph√∫t/kho)
        const totalCheckTime = totalAvailableTime - totalTravelTime;
        const checkTimePerWarehouse = Math.floor(totalCheckTime / warehouseCount);

        if (checkTimePerWarehouse <= 0) {
            errorDiv.textContent = 'L·ªói: Th·ªùi gian ki·ªÉm tra qu√° ng·∫Øn ho·∫∑c kh√¥ng ƒë·ªß th·ªùi gian l√†m vi·ªác cho s·ªë l∆∞·ª£ng kho n√†y.';
            return;
        }

        // 4. Chia s·ªë l∆∞·ª£ng kho gi·ªØa s√°ng v√† chi·ªÅu
        // M·ª•c ti√™u: c√¢n b·∫±ng s·ªë l∆∞·ª£ng kho ƒë·ªÉ bu·ªïi chi·ªÅu k·∫øt th√∫c ƒë√∫ng gi·ªù PM_END
        
        let amCount = Math.ceil(warehouseCount / 2); // B·∫Øt ƒë·∫ßu v·ªõi s·ªë l∆∞·ª£ng kho s√°ng/chi·ªÅu b·∫±ng nhau
        let pmCount = warehouseCount - amCount;

        // T√≠nh th·ªùi gian t·ªëi thi·ªÉu c·∫ßn thi·∫øt cho bu·ªïi chi·ªÅu ƒë·ªÉ ƒë·∫°t ƒë∆∞·ª£c PM_END
        let pmTravel = travels.slice(amCount - 1, warehouseCount - 1).reduce((a, b) => a + b, 0);
        let pmRequiredTime = (pmCount * checkTimePerWarehouse) + pmTravel;
        
        // ƒêi·ªÅu ch·ªânh s·ªë l∆∞·ª£ng kho bu·ªïi s√°ng/chi·ªÅu cho ƒë·∫øn khi th·ªùi gian bu·ªïi chi·ªÅu kh·ªõp
        while (pmRequiredTime > pmTotal && amCount < warehouseCount) {
            amCount++;
            pmCount--;
            if (pmCount <= 0) break; // Tr∆∞·ªùng h·ª£p kh√¥ng th·ªÉ chia ƒë∆∞·ª£c
            pmTravel = travels.slice(amCount - 1, warehouseCount - 1).reduce((a, b) => a + b, 0);
            pmRequiredTime = (pmCount * checkTimePerWarehouse) + pmTravel;
        }
        
        if (pmRequiredTime > pmTotal) {
             errorDiv.textContent = 'C·∫£nh b√°o: Kh√¥ng th·ªÉ ho√†n th√†nh l·ªãch tr√¨nh. Vui l√≤ng tƒÉng th·ªùi gian l√†m vi·ªác ho·∫∑c gi·∫£m s·ªë l∆∞·ª£ng kho.';
             return;
        }
        
        // 5. T·∫°o b·∫£ng k·∫øt qu·∫£
        let tableHTML = '<thead><tr><th>STT</th><th>T√™n Kho</th><th>B·∫Øt ƒë·∫ßu (Ki·ªÉm tra)</th><th>K·∫øt th√∫c (Ki·ªÉm tra)</th></tr></thead><tbody>';
        let currentTime = timeToMinutes(amStart);
        let currentTravelIndex = 0;
        let isAM = true;
        
        // H√†m th√™m m·ªôt d√≤ng v√†o b·∫£ng
        const addRow = (index, name, startMin, endMin) => {
            const startStr = minutesToTime(startMin);
            const endStr = minutesToTime(endMin);
            return `<tr><td>${index}</td><td>${name}</td><td>${startStr}</td><td>${endStr}</td></tr>`;
        };
        
        // Th√™m ti√™u ƒë·ªÅ Bu·ªïi S√°ng
        tableHTML += `<tr class="header-section"><td colspan="4">BU·ªîI S√ÅNG (${amCount} KHO)</td></tr>`;

        // L·ªãch tr√¨nh Bu·ªïi S√°ng
        for (let i = 0; i < amCount; i++) {
            const startIndex = currentTime;
            const endIndex = startIndex + checkTimePerWarehouse;
            tableHTML += addRow(i + 1, names[i], startIndex, endIndex);
            
            currentTime = endIndex;
            if (i < amCount - 1) {
                // Th√™m th·ªùi gian di chuy·ªÉn
                currentTime += travels[currentTravelIndex];
                currentTravelIndex++;
            }
        }
        
        // Th√™m ti√™u ƒë·ªÅ Bu·ªïi Chi·ªÅu
        tableHTML += `<tr class="header-section"><td colspan="4">BU·ªîI CHI·ªÄU (${pmCount} KHO)</td></tr>`;
        
        // Chuy·ªÉn sang th·ªùi gian b·∫Øt ƒë·∫ßu bu·ªïi chi·ªÅu
        currentTime = timeToMinutes(pmStart);

        // L·ªãch tr√¨nh Bu·ªïi Chi·ªÅu
        for (let i = amCount; i < warehouseCount; i++) {
            const startIndex = currentTime;
            const endIndex = startIndex + checkTimePerWarehouse;
            tableHTML += addRow(i + 1, names[i], startIndex, endIndex);

            currentTime = endIndex;
            if (i < warehouseCount - 1) {
                // Th√™m th·ªùi gian di chuy·ªÉn
                currentTime += travels[currentTravelIndex];
                currentTravelIndex++;
            }
        }
        
        tableHTML += '</tbody>';
        document.getElementById('resultTable').innerHTML = tableHTML;
        
        // Hi·ªÉn th·ªã th√¥ng tin t·ªïng k·∫øt (T√πy ch·ªçn)
        const summary = `<p style="margin-top: 20px; text-align: center; font-style: italic;">Th·ªùi gian ki·ªÉm tra c·ªë ƒë·ªãnh m·ªói kho: **${checkTimePerWarehouse} ph√∫t**</p>`;
        document.getElementById('resultTable').insertAdjacentHTML('beforebegin', summary);
    }

    function copyTable() {
        const table = document.getElementById('resultTable');
        const range = document.createRange();
        range.selectNode(table);
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(range);
        
        try {
            document.execCommand('copy');
            alert('ƒê√£ sao ch√©p b·∫£ng v√†o clipboard th√†nh c√¥ng!');
        } catch (err) {
            console.error('Kh√¥ng th·ªÉ sao ch√©p', err);
            alert('Sao ch√©p th·∫•t b·∫°i. Vui l√≤ng ch·ªçn v√† copy th·ªß c√¥ng.');
        }
        
        window.getSelection().removeAllRanges();
    }

    // T·∫£i d·ªØ li·ªáu m·∫∑c ƒë·ªãnh khi trang load
    document.addEventListener('DOMContentLoaded', calculateSchedule);
</script>

</body>
</html>
